name: Java CI with Expressions Demo

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

env:
  JAVA_VERSION: '11'

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Java
      uses: actions/setup-java@v4
      with:
        java-version: ${{ env.JAVA_VERSION }}
        distribution: 'temurin'
        cache: 'maven'

    - name: Validate pom.xml
      run: mvn validate

    - name: Compile code
      run: mvn compile

    - name: Run tests
      run: mvn test

    - name: Show GitHub Context
      run: |
        echo "=== GitHub Context ==="
        echo "Repository: ${{ github.repository }}"
        echo "Event: ${{ github.event_name }}"
        echo "Ref: ${{ github.ref }}"
        echo "SHA: ${{ github.sha }}"
        echo "Actor: ${{ github.actor }}"
        echo "Workflow: ${{ github.workflow }}"

    - name: Show Runner Context
      run: |
        echo "=== Runner Context ==="
        echo "OS: ${{ runner.os }}"
        echo "Workspace: ${{ runner.workspace }}"
        echo "Temp: ${{ runner.temp }}"

    - name: Show Job Context
      run: |
        echo "=== Job Context ==="
        echo "Job Status: ${{ job.status }}"
        echo "Runner Name: ${{ runner.name }}"

    - name: Show Environment Context
      run: |
        echo "=== Environment Context ==="
        echo "Java Version: ${{ env.JAVA_VERSION }}"
        echo "Runner OS: ${{ runner.os }}"

    - name: Conditional Expressions Demo
      run: |
        echo "=== Conditional Expressions ==="
        echo "Is push event: ${{ github.event_name == 'push' }}"
        echo "Is main branch: ${{ github.ref == 'refs/heads/main' }}"
        echo "Is workflow_dispatch: ${{ github.event_name == 'workflow_dispatch' }}"

  expressions-demo:
    runs-on: ubuntu-latest
    needs: build-and-test
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Advanced Expressions
      run: |
        echo "=== Advanced Expression Examples ==="
        echo "Branch name: ${{ github.ref_name }}"
        echo "Short SHA: ${{ github.sha }}"
        echo "Repository owner: ${{ github.repository_owner }}"
        echo "Event payload path: ${{ github.event_path }}"
        echo "Action ID: ${{ github.action }}"
        echo "Run ID: ${{ github.run_id }}"
        echo "Run number: ${{ github.run_number }}"

    - name: String Functions
      run: |
        echo "=== String Function Examples ==="
        # Note: GitHub expressions in run commands don't support all functions directly
        # These would typically be used in if conditions or other expressions
        echo "Using contains in condition below"
        
    - name: Contains example
      if: ${{ contains(github.ref, 'main') }}
      run: echo "This runs only on main branch"

    - name: Always run step
      if: ${{ always() }}
      run: echo "This step always runs to show completion status"
